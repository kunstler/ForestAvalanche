---
title: "Plots_data_03MAR20"
output: html_document
---


Chargement des packages et objets utiles :
```{r,  warning=FALSE}
library(drake)
library(stringr)
library(FD)
library(dplyr)

loadd(FD_C2, FD_C3, FD_C4, plotsC2, plotsC3, plotsC4)
```


Jointure des tableaux :
```{r, warning=FALSE}
nb_sp <-  FD_C2[["nbsp"]]
fonctional_C2 <- as.data.frame(nb_sp);fonctional_C2$rich_fonc <- FD_C2[["FRic"]];
fonctional_C2$evenness <- FD_C2[["FEve"]];fonctional_C2$div_fonc <- FD_C2[["FDiv"]];
fonctional_C2$dist_fonc <- FD_C2[["FDis"]];fonctional_C2$idp <- row.names(fonctional_C2)
C2 <- left_join(plotsC2[,c("IDENTIFIANT_DU_POINT","mean_age","avalanche_path", "altitude")],
                fonctional_C2, by = c("IDENTIFIANT_DU_POINT" = "idp"))
name_C2 <- colnames(C2)

nb_sp <-  FD_C3[["nbsp"]]
fonctional_C3 <- as.data.frame(nb_sp);fonctional_C3$rich_fonc <- FD_C3[["FRic"]];
fonctional_C3$evenness <- FD_C3[["FEve"]];fonctional_C3$div_fonc <- FD_C3[["FDiv"]];
fonctional_C3$dist_fonc <- FD_C3[["FDis"]];fonctional_C3$idp <- row.names(fonctional_C3)
C3 <- left_join(plotsC3[,c("CPP","mean_age","avalanche_path", "altitude")],
                fonctional_C3, by = c("CPP" = "idp"))
name_C3 <- colnames(C3)

nb_sp <-  FD_C4[["nbsp"]]
fonctional_C4 <- as.data.frame(nb_sp);fonctional_C4$rich_fonc <- FD_C4[["FRic"]];
fonctional_C4$evenness <- FD_C4[["FEve"]];fonctional_C4$div_fonc <- FD_C4[["FDiv"]];
fonctional_C4$dist_fonc <- FD_C4[["FDis"]];fonctional_C4$idp <- as.numeric(as.character(row.names(fonctional_C4)))
C4 <- left_join(plotsC4[,c("idp","mean_age","avalanche_path", "altitude")],
                fonctional_C4, by = c("idp" = "idp"))
name_C4 <- colnames(C4)
```

## Plots des indices de diversité fonctionnelle en fonction de l'âge moyen de la placette

C2
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C2$mean_age,C2[,3+i], ylab = name_C2[3+i], xlab = "mean_age",col = ifelse( C2$altitude < 1500,'blue','red'), pch = 20, main = "C2")
}
```

C3 :
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C3$mean_age,C3[,3+i], ylab = name_C3[3+i], xlab = "mean_age",col = ifelse( C3$altitude < 1500,'blue','red'), pch = 20, main = "C3")
}
```

C4 :
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C4$mean_age,C4[,3+i], ylab = name_C4[3+i], xlab = "mean_age",col = ifelse( C4$altitude < 1500,'blue','red'), pch = 20, main = "C4")
}
```

## Richesse spécifique en fonction de l'altitude
```{r}
par(mfrow = c(1,3))
plot(C2$altitude,C2[,"nb_sp"], ylab = "Richesse specifique", xlab = "altitude",col = ifelse( C2$avalanche_path == "IN",'green','red'), pch = 20)
plot(C3$altitude,C3[,"nb_sp"], ylab = "Richesse specifique", xlab = "altitude",col = ifelse( C3$avalanche_path == "IN",'green','red'), pch = 20)
plot(C4$altitude,C4[,"nb_sp"], ylab = "Richesse specifique", xlab = "altitude",col = ifelse( C4$avalanche_path == "IN",'green','red'), pch = 20)

```


## Richesse fonctionnelle en fonction de l'altitude
```{r}
par(mfrow = c(1,3))
plot(C2$altitude,C2[,"rich_fonc"], ylab = "rich_fonc", xlab = "altitude",col = ifelse( C2$avalanche_path == "IN",'green','red'), pch = 20)
plot(C3$altitude,C3[,"rich_fonc"], ylab = "rich_fonc", xlab = "altitude",col = ifelse( C3$avalanche_path == "IN",'green','red'), pch = 20)
plot(C4$altitude,C4[,"rich_fonc"], ylab = "rich_fonc", xlab = "altitude",col = ifelse( C4$avalanche_path == "IN",'green','red'), pch = 20)

```
Diminution de la richesse fonctionnelle quand augmentation de l'altitude

## Indices de diversité fonctionnelle en fonction de l'âge moyen de la placette

Vert = placettes "IN" avalanche path
Rouge = placettes "OUT" avalanche path

C2 :
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C2$mean_age,C2[,3+i], ylab = name_C2[3+i], xlab = "mean_age",col = ifelse( C2$avalanche_path == "IN",'green','red'), pch = 20)
}
```

C3 :
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C3$mean_age,C3[,3+i], ylab = name_C3[3+i], xlab = "mean_age",col = ifelse( C3$avalanche_path == "IN",'green','red'), pch = 20)
}
```

C4 :
```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C4$mean_age,C4[,3+i], ylab = name_C4[3+i], xlab = "mean_age",col = ifelse( C4$avalanche_path == "IN",'green','red'), pch = 20)
}
```

# Plots ces CWM

Préparation des données
```{r, echo = FALSE}
CWMC2 <- FD_C2[["CWM"]]
CWMC2$idp <- row.names(CWMC2)
C2_cwm <- left_join(plotsC2[,c("IDENTIFIANT_DU_POINT","mean_age","avalanche_path")],CWMC2, by = c("IDENTIFIANT_DU_POINT" = "idp"))
name_C2_cwm <- colnames(C2_cwm)


CWMC3 <- FD_C3[["CWM"]]
CWMC3$idp <- row.names(CWMC3)
C3_cwm <- left_join(plotsC3[,c("CPP","mean_age","avalanche_path")],CWMC3, by = c("CPP" = "idp"))
name_C3_cwm <- colnames(C3_cwm)


CWMC4 <- FD_C4[["CWM"]]
CWMC4$idp <- as.numeric(row.names(CWMC4))
C4_cwm <- left_join(plotsC4[,c("idp","mean_age","avalanche_path")],CWMC4, by = c("idp" = "idp"))
name_C4_cwm <- colnames(C4_cwm)
```

```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C2_cwm$mean_age,C2_cwm[,3+i], ylab = paste("CWM_",name_C2_cwm[3+i]), xlab = "mean_age",col = ifelse( C2_cwm$avalanche_path == "IN",'green','red'), main = "C2")
} 

par(mfrow = c(2,3))
for (i in 7:12) {
  plot(C2_cwm$mean_age,C2_cwm[,3+i], ylab = paste("CWM_",name_C2_cwm[3+i]), xlab = "mean_age",col = ifelse( C2_cwm$avalanche_path == "IN",'green','red'), main = "C2")
} 

par(mfrow = c(1,3))
for (i in 13:15) {
  plot(C2_cwm$mean_age,C2_cwm[,3+i], ylab = paste("CWM_",name_C2_cwm[3+i]), xlab = "mean_age",col = ifelse( C2_cwm$avalanche_path == "IN",'green','red'), main = "C2")
}
```

```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C3_cwm$mean_age,C3_cwm[,3+i], ylab = paste("CWM_",name_C3_cwm[3+i]), xlab = "mean_age",col = ifelse( C3_cwm$avalanche_path == "IN",'green','red'), main = "C3")
} 

par(mfrow = c(2,3))
for (i in 7:12) {
  plot(C3_cwm$mean_age,C3_cwm[,3+i], ylab = paste("CWM_",name_C3_cwm[3+i]), xlab = "mean_age",col = ifelse( C3_cwm$avalanche_path == "IN",'green','red'), main = "C3")
} 

par(mfrow = c(1,3))
for (i in 13:15) {
  plot(C3_cwm$mean_age,C3_cwm[,3+i], ylab = paste("CWM_",name_C3_cwm[3+i]), xlab = "mean_age",col = ifelse( C3_cwm$avalanche_path == "IN",'green','red'), main = "C3")
}
```

```{r}
par(mfrow = c(2,3))
for (i in 1:6) {
  plot(C4_cwm$mean_age,C4_cwm[,3+i], ylab = paste("CWM_",name_C4_cwm[3+i]), xlab = "mean_age",col = ifelse( C4_cwm$avalanche_path == "IN",'green','red'), main = "C4")
} 

par(mfrow = c(2,3))
for (i in 7:12) {
  plot(C4_cwm$mean_age,C4_cwm[,3+i], ylab = paste("CWM_",name_C4_cwm[3+i]), xlab = "mean_age",col = ifelse( C4_cwm$avalanche_path == "IN",'green','red'), main = "C4")
} 

par(mfrow = c(1,3))
for (i in 13:15) {
  plot(C4_cwm$mean_age,C4_cwm[,3+i], ylab = paste("CWM_",name_C4_cwm[3+i]), xlab = "mean_age",col = ifelse( C4_cwm$avalanche_path == "IN",'green','red'), main = "C4")
}
```

# Plots des variables de structures

préparation des données :
```{r,  warning=FALSE}
loadd(basal_area_C2,basal_area_C3,basal_area_C4,stem_nb_C2,stem_nb_C3,stem_nb_C4,
      DQ_C2,DQ_C3,DQ_C4,Cv_C2,Cv_C3,Cv_C4)
loadd(plotsC2,plotsC3,plotsC4)

plots_C2 <- left_join(plotsC2, stem_nb_C2[,c("IDENTIFIANT_DU_POINT", "stem_nb_tot")], by = "IDENTIFIANT_DU_POINT")
plots_C2 <- left_join(plots_C2, basal_area_C2[,c("basal_area_tot","IDENTIFIANT_DU_POINT")], by = "IDENTIFIANT_DU_POINT")
plots_C2 <- left_join(plots_C2, DQ_C2, by = c("IDENTIFIANT_DU_POINT" = "idp"))
plots_C2 <- left_join(plots_C2, Cv_C2, by = "IDENTIFIANT_DU_POINT")

plots_C3 <- left_join(plotsC3, stem_nb_C3[,c("CPP", "stem_nb_tot")], by = "CPP")
plots_C3 <- left_join(plots_C3, basal_area_C3[,c("basal_area_tot","CPP")], by = "CPP")
plots_C3 <- left_join(plots_C3, DQ_C3, by = c("CPP" = "idp"))
plots_C3 <- left_join(plots_C3, Cv_C3, by = "CPP")

stem_nb_C4$idp <- as.numeric(as.character(stem_nb_C4$idp))
basal_area_C4$idp <- as.numeric(as.character(basal_area_C4$idp))
DQ_C4$idp <- as.numeric(as.character(DQ_C4$idp))
Cv_C4$idp <- as.numeric(as.character(Cv_C4$idp))
plots_C4 <- left_join(plotsC4, stem_nb_C4[,c("idp", "stem_nb_tot")], by = "idp")
plots_C4 <- left_join(plots_C4,basal_area_C4[,c("basal_area_tot","idp")], by = "idp")
plots_C4 <- left_join(plots_C4, DQ_C4, by = "idp")
plots_C4 <- left_join(plots_C4, Cv_C4, by = "idp")

colonnes <- c("stem_nb_tot","basal_area_tot", "RMS_diam","Coef_var_diam")
```

C2
```{r}
par(mfrow = c(2,2))
for (i in 1:4) {
  plot(plots_C2$mean_age,plots_C2[,colonnes[i]], ylab = colonnes[i], xlab = "mean_age",col = ifelse( C2$avalanche_path == "IN",'green','red'), pch = 20, main = "C2")
}
```

C3
```{r}
par(mfrow = c(2,2))
for (i in 1:4) {
  plot(plots_C3$mean_age,plots_C3[,colonnes[i]], ylab = colonnes[i], xlab = "mean_age",col = ifelse( C3$avalanche_path == "IN",'green','red'), pch = 20, main = "C3")
}
```

C4
```{r}
par(mfrow = c(2,2))
for (i in 1:4) {
  plot(plots_C4$mean_age,plots_C4[,colonnes[i]], ylab = colonnes[i], xlab = "mean_age",col = ifelse( C4$avalanche_path == "IN",'green','red'), pch = 20, main = "C4")
}
```
